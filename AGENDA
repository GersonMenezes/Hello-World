#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct tipo{
char nome[30];
int idade;
int cell;
};

struct tam{
int cont, x, n;
};

int *cont, *x, *n;
struct tipo *pPessoa;
void *pBuffer;
int menu();
void retira();
void lista();
void busca();
void adiciona();
void appoint();

int main(){

    pBuffer = (void*) malloc(sizeof(struct tam));
        if(pBuffer != NULL) printf("Alocado com sucesso\n");

    appoint();

    *n = 0;
    *x = 1;

    printf("%d\n\n", *n);

    while(*x != 0){
    *x = menu();
    }

    printf("Valor de X=%d",*x);
    free(pBuffer);
        if(pBuffer != NULL) {
                printf("\n\nMemoria nao limpada com sucesso");}

return 0;
}
void appoint(){
    x = pBuffer;
    n = x+1;
    cont = n+1;
}

int menu(){

    printf("Diga a opcao desejada: ");
    printf("\n0 para sair\n1 Adicionar\n2 Retirar\n3 Listar\n4 Buscar\n");
    scanf("%d", &*x);

        switch (*x){
        case 0:
            return 0;
            break;
        case 1:
            adiciona();
            break;
        case 2:
            retira();
            break;
        case 3:
            lista();
            break;
        case 4:
            busca();
            break;
        default:
            printf("Nenhuma alternativa correta");
        }
    getchar();
    return 1;
}

void retira(){
    /*auxname =(char*) (pBuffer + (sizeof(struct tam)-(20*sizeof(char))));
    //auxname = sizeof(struct tam)-(20*sizeof(char));
    printf("Diga o nome que desejas tirar");
    scanf("%s", auxname);

        for(*cont=0; *cont<*n; *cont++){

        }*/
    }
void lista(){
    if(*n==0){
            printf("Ninguem na lista\n");
        }
    else{
            pPessoa =(struct tipo*) cont + 1;
        for(*cont=0; *cont<(*n); (*cont)++){
            
            printf("*n = %d, *cont = %d", *n, *cont);
            printf("\n\nNome: %s\n", pPessoa->nome);
            printf("Idade:%d\n", pPessoa->idade);
            printf("Telefone: %d \n\n", pPessoa->cell);
            pPessoa = pPessoa + sizeof(struct tipo);
        }
    }
}
void busca(){}

void adiciona(){
    *n = *n + 1;
    printf("\nN = %d\n", *n);
    pBuffer =  realloc(pBuffer, (sizeof(int)*3) + (sizeof(struct tipo)*(*n)));
        if(pBuffer != NULL) printf("Sucess Reallocation\n");
        if(pBuffer == NULL) printf("Do not allocated");

    appoint();
    printf("\nN again = %d\n", *n);
        pPessoa =(struct tipo*) cont + 1;
        pPessoa = pPessoa + (sizeof(struct tipo)*(*n-1));
        printf("Diga o nome: ");
        scanf("%s", pPessoa->nome);
        printf("Diga a IDADE: ");
        scanf("%d", &pPessoa->idade);
        printf("Diga o TELEFONE: ");
        scanf("%d", &pPessoa->cell);
}

